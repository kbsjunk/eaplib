{% extends 'layout.twig' %}
{% block page_title %}Import Data{% endblock %}
{% block header_scripts %}<link href="{{ urlFor('home') }}assets/css/bootstrap-fileupload.min.css" rel="stylesheet">{% endblock %}
{% block footer_scripts %}<script src="{{ urlFor('home') }}assets/js/bootstrap-fileupload.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
	$('#uploadfile').change( function() {
		var file = $('#uploadfile').val();
		
		$('.highlight').removeClass('highlight');
		
		file = file.split('.');
		var filename = file.shift();
		var fileext = file.pop();
		var filetypes = ['xml'];	
		
	});
});
</script>
{% endblock %}

{% block content %}
<h4>
	Import Data
</h4>
<article>
{% if message or error %}
{% 
	set messages = {
	nofile: 'No file was uploaded.',
	success: 'The file was imported succesfully.',
	wrongnumcolumns: 'The file you have uploaded contains the wrong number of columns.',
	wrongnamecolumns: 'The file you have uploaded contains the wrong column names.<br> You must export the SQL in the format generated by the <a href="' ~ urlFor('sql_queries')  ~ '">relevant SQL query.</a>',
	invalid: 'The file you have uploaded cannot be read as XML format.',
	unchanged: 'The file you have uploaded is unchanged since the last time it was uploaded. No processing is necessary.',
}
%}
<div class="alert {% if error %}alert-error{% endif %}">
	<button type="button" class="close" data-dismiss="alert">&times;</button>
	<strong>{{ error ? 'Error' : 'Notice'}}</strong> {{ attribute(messages, message ? message : error) }}
	<br>View the log file: <a href="{{ urlFor('import_log',  { logfile: logfile }) }}">{{ logfile }}</a>.
</div>
{% endif %}

<p>
	The input file must be an XML file exported from ISIS using the provided <a href="{{ urlFor('export') }}">ISIS Export Script</a>.
</p>

<form action="{{ urlFor('import') }}" method="post" enctype="multipart/form-data">
	
	<label for="uploadfile">
		Select File
	</label>
	
	<div class="fileupload fileupload-new" data-provides="fileupload">
		<div class="input-append">
			<div class="uneditable-input span3"><i class="icon-file fileupload-exists"></i> <span class="fileupload-preview"></span></div><span class="btn btn-file"><span class="fileupload-new">Select file</span><span class="fileupload-exists">Change</span><input type="file" name="uploadfile" id="uploadfile" /></span><a href="#" class="btn fileupload-exists" data-dismiss="fileupload">Remove</a>
		</div>
	</div>
			
	<input type="submit" class="btn btn-large" value="Upload" />
	
</form>
</article>
<div class="pagination">
	<ul>
		<li><a href="{{ urlFor('import_logs') }}"><i class="icon-double-angle-left"></i> Import Logs</a></li>
		<li><a href="{{ urlFor('export') }}"><i class="icon-double-angle-left"></i> ISIS Export Script</a></li>
	</ul>
</div>
{% endblock %}